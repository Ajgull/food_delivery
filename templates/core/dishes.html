{% extends 'base.html' %}

{% block title %}Dishes{% endblock %}

{% block content %}
    <div class="d-flex justify-content-center gap-3 my-3">
        {% if user.is_authenticated %}
            {% if is_restaurant %}
                <a href="{% url 'register' %}" class="btn btn-primary">Create an Account</a>
                <a href="{% url 'login' %}" class="btn btn-outline-primary">Log in</a>
            {% elif is_customer %}
                <h2>Hi, {{ request.user.username }}</h2>
                <a href="{% url 'logout' %}" class="btn btn-outline-primary">Log out</a>
            {% elif is_courier %}
                <a href="{% url 'logout' %}" class="btn btn-outline-primary">Log out</a>
            {% else %}
                Hi, {{user.first_name}}.
                <a href="{% url 'logout' %}" class="btn btn-outline-primary">Log out</a>
                <a href="{% url 'dish_create' %}" class="btn btn-outline-primary">Create dish</a>
            {% endif %}
                <div style="border: 1px solid #ccc; padding: 10px; width: 300px; text-align: left; position: fixed; top: 10px; right: 10px; background: #f8f9fa;">
                    <strong>Cart ({{ cart_total_items|default:0 }} items)</strong>
                    
                    {% if cart_dishes %}
                        <ul style="list-style: none; padding-left: 0;">
                        {% for item in cart_dishes %}
                            <li>
                            {{ item.dish.name }} — {{ item.quantity }} шт. — {{ item.subtotal|floatformat:2 }} ₽
                            </li>
                        {% endfor %}
                        </ul>
                        <hr>
                        <p><strong>Total: {{ cart_total_price|floatformat:2 }} ₽</strong></p>
                    {% else %}
                        <p>No items in cart</p>
                    {% endif %}
                    </div>

        {% else %}
            <a href="{% url 'register' %}" class="btn btn-primary">Create an Account</a>
            <a href="{% url 'login' %}" class="btn btn-outline-primary">Log in</a>
        {% endif %}
    </div>

    <h1>Dishes</h1>

    {% for dish in dishes %}
        <div class="dish-card">
            <img src="{{ dish.image.url }}" alt="{{ dish.name }}">
            <h3>{{ dish.name }}</h3>
            <p>Price: {{ dish.price }}</p>
            <a href="{% url 'dish_detail' dish.pk %}" class="btn btn-outline-primary">more information</a>
            <a href="{% url 'dish_update' dish.pk %}" class="btn btn-outline-primary">update</a>
            <a href="{% url 'dish_delete' dish.pk %}" class="btn btn-outline-primary">delete</a>
            <form method="post" action="{% url 'add_to_cart' dish.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-primary">Add to cart</button>
            </form>

            <form method="post" action="{% url 'remove_from_cart' dish.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-primary">Remove from cart</button>
            </form>

        </div>
    {% empty %}
        <li>No dishes</li>
    {% endfor %}

{% endblock %}
